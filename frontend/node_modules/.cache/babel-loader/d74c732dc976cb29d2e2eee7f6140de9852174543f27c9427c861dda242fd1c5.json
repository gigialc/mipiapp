{"ast":null,"code":"var _jsxFileName = \"/Users/georgina/DestigFemmeDemoPi/frontend/src/Shop/index.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport ProductCard from './components/ProductCard';\nimport SignIn from './components/SignIn';\nimport Header from './components/Header';\nimport MuiBottomNavigation from '../MuiBottomNavigation';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n;\n\n// Make TS accept the existence of our window.__ENV object - defined in index.html:\n\nconst _window = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\nconst axiosClient = axios.create({\n  baseURL: `${backendURL}`,\n  timeout: 20000,\n  withCredentials: true\n});\nconst config = {\n  headers: {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': '*'\n  }\n};\nexport default function Shop() {\n  _s();\n  const [user, setUser] = useState(null);\n  const [showModal, setShowModal] = useState(false);\n  const signIn = async () => {\n    const scopes = ['username', 'payments'];\n    const authResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n    signInUser(authResult);\n    setUser(authResult.user);\n  };\n  const signOut = () => {\n    setUser(null);\n    signOutUser();\n  };\n  const signInUser = authResult => {\n    axiosClient.post('/user/signin', {\n      authResult\n    });\n    return setShowModal(false);\n  };\n  const signOutUser = () => {\n    return axiosClient.get('/user/signout');\n  };\n  const onModalClose = () => {\n    setShowModal(false);\n  };\n  const orderProduct = async (memo, amount, paymentMetadata) => {\n    if (user === null) {\n      return setShowModal(true);\n    }\n    const paymentData = {\n      amount,\n      memo,\n      metadata: paymentMetadata\n    };\n    const callbacks = {\n      onReadyForServerApproval,\n      onReadyForServerCompletion,\n      onCancel,\n      onError\n    };\n    const payment = await window.Pi.createPayment(paymentData, callbacks);\n    console.log(payment);\n  };\n  const onIncompletePaymentFound = payment => {\n    console.log(\"onIncompletePaymentFound\", payment);\n    return axiosClient.post('/payments/incomplete', {\n      payment\n    });\n  };\n  const onReadyForServerApproval = paymentId => {\n    console.log(\"onReadyForServerApproval\", paymentId);\n    axiosClient.post('/payments/approve', {\n      paymentId\n    }, config);\n  };\n  const onReadyForServerCompletion = (paymentId, txid) => {\n    console.log(\"onReadyForServerCompletion\", paymentId, txid);\n    axiosClient.post('/payments/complete', {\n      paymentId,\n      txid\n    }, config);\n  };\n  const onCancel = paymentId => {\n    console.log(\"onCancel\", paymentId);\n    return axiosClient.post('/payments/cancelled_payment', {\n      paymentId\n    });\n  };\n  const onError = (error, payment) => {\n    console.log(\"onError\", error);\n    if (payment) {\n      console.log(payment);\n      // handle the error accordingly\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      user: user,\n      onSignIn: signIn,\n      onSignOut: signOut\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProductCard, {\n      name: \"Apple Pie\",\n      description: \"You know what this is. Pie. Apples. Apple pie.\",\n      price: 3,\n      onClickBuy: () => orderProduct(\"Order Apple Pie\", 3, {\n        productId: 'apple_pie_1'\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProductCard, {\n      name: \"Lemon Meringue Pie\",\n      description: \"Non-contractual picture. We might have used oranges because we had no lemons. Order at your own risk.\",\n      price: 5,\n      onClickBuy: () => orderProduct(\"Order Lemon Meringue Pie\", 5, {\n        productId: 'lemon_pie_1'\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this), showModal && /*#__PURE__*/_jsxDEV(SignIn, {\n      onSignIn: signIn,\n      onModalClose: onModalClose\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 22\n    }, this), /*#__PURE__*/_jsxDEV(MuiBottomNavigation, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(Shop, \"7F3ln6W08puJMs22ml1OmKJPERk=\");\n_c = Shop;\nvar _c;\n$RefreshReg$(_c, \"Shop\");","map":{"version":3,"names":["React","useState","axios","ProductCard","SignIn","Header","MuiBottomNavigation","jsxDEV","_jsxDEV","Fragment","_Fragment","_window","window","backendURL","__ENV","axiosClient","create","baseURL","timeout","withCredentials","config","headers","Shop","_s","user","setUser","showModal","setShowModal","signIn","scopes","authResult","Pi","authenticate","onIncompletePaymentFound","signInUser","signOut","signOutUser","post","get","onModalClose","orderProduct","memo","amount","paymentMetadata","paymentData","metadata","callbacks","onReadyForServerApproval","onReadyForServerCompletion","onCancel","onError","payment","createPayment","console","log","paymentId","txid","error","children","onSignIn","onSignOut","fileName","_jsxFileName","lineNumber","columnNumber","name","description","price","onClickBuy","productId","_c","$RefreshReg$"],"sources":["/Users/georgina/DestigFemmeDemoPi/frontend/src/Shop/index.tsx"],"sourcesContent":["import React, {useState} from 'react';\nimport axios from 'axios';\nimport ProductCard from './components/ProductCard';\nimport SignIn from './components/SignIn';\nimport Header from './components/Header';\nimport MuiBottomNavigation from '../MuiBottomNavigation';\n\ntype MyPaymentMetadata = {};\n\ntype AuthResult = {\n  accessToken: string,\n  user: {\n    uid: string,\n    username: string\n  }\n};\n\nexport type User = AuthResult['user'];\n\ninterface PaymentDTO {\n  amount: number,\n  user_uid: string,\n  created_at: string,\n  identifier: string,\n  metadata: Object,\n  memo: string,\n  status: {\n    developer_approved: boolean,\n    transaction_verified: boolean,\n    developer_completed: boolean,\n    cancelled: boolean,\n    user_cancelled: boolean,\n  },\n  to_address: string,\n  transaction: null | {\n    txid: string,\n    verified: boolean,\n    _link: string,\n  },\n};\n\n// Make TS accept the existence of our window.__ENV object - defined in index.html:\ninterface WindowWithEnv extends Window {\n  __ENV?: {\n    backendURL: string, // REACT_APP_BACKEND_URL environment variable\n    sandbox: \"true\" | \"false\", // REACT_APP_SANDBOX_SDK environment variable - string, not boolean!\n  }\n}\n\nconst _window: WindowWithEnv = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\n\nconst axiosClient = axios.create({ baseURL: `${backendURL}`, timeout: 20000, withCredentials: true});\nconst config = {headers: {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'}};\n\n\nexport default function Shop() {\n  const [user, setUser] = useState<User | null>(null);\n  const [showModal, setShowModal] = useState<boolean>(false);\n\n  const signIn = async () => {\n    const scopes = ['username', 'payments'];\n    const authResult: AuthResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n    signInUser(authResult);\n    setUser(authResult.user);\n  }\n\n  const signOut = () => {\n    setUser(null);\n    signOutUser();\n  }\n\n  const signInUser = (authResult: AuthResult) => {\n    axiosClient.post('/user/signin', {authResult});\n    return setShowModal(false);\n  }\n\n  const signOutUser = () => {\n    return axiosClient.get('/user/signout');\n  }\n\n  const onModalClose = () => {\n    setShowModal(false);\n  }\n\n  const orderProduct = async (memo: string, amount: number, paymentMetadata: MyPaymentMetadata) => {\n    if(user === null) {\n      return setShowModal(true);\n    }\n    const paymentData = { amount, memo, metadata: paymentMetadata };\n    const callbacks = {\n      onReadyForServerApproval,\n      onReadyForServerCompletion,\n      onCancel,\n      onError\n    };\n    const payment = await window.Pi.createPayment(paymentData, callbacks);\n    console.log(payment);\n  }\n\n  const onIncompletePaymentFound = (payment: PaymentDTO) => {\n    console.log(\"onIncompletePaymentFound\", payment);\n    return axiosClient.post('/payments/incomplete', {payment});\n  }\n\n  const onReadyForServerApproval = (paymentId: string) => {\n    console.log(\"onReadyForServerApproval\", paymentId);\n    axiosClient.post('/payments/approve', {paymentId}, config);\n  }\n\n  const onReadyForServerCompletion = (paymentId: string, txid: string) => {\n    console.log(\"onReadyForServerCompletion\", paymentId, txid);\n    axiosClient.post('/payments/complete', {paymentId, txid}, config);\n  }\n\n  const onCancel = (paymentId: string) => {\n    console.log(\"onCancel\", paymentId);\n    return axiosClient.post('/payments/cancelled_payment', {paymentId});\n  }\n\n  const onError = (error: Error, payment?: PaymentDTO) => {\n    console.log(\"onError\", error);\n    if (payment) {\n      console.log(payment);\n      // handle the error accordingly\n    }\n  }\n\n  return (\n    <>\n      <Header user={user} onSignIn={signIn} onSignOut={signOut}/>\n\n      <ProductCard\n        name=\"Apple Pie\"\n        description=\"You know what this is. Pie. Apples. Apple pie.\"\n        price={3}\n        onClickBuy={() => orderProduct(\"Order Apple Pie\", 3, { productId: 'apple_pie_1' })}\n      />\n      <ProductCard\n        name=\"Lemon Meringue Pie\"\n        description=\"Non-contractual picture. We might have used oranges because we had no lemons. Order at your own risk.\"\n        price={5}\n        onClickBuy={() => orderProduct(\"Order Lemon Meringue Pie\", 5, { productId: 'lemon_pie_1' })}\n      />\n\n      { showModal && <SignIn onSignIn={signIn} onModalClose={onModalClose} /> }\n      <MuiBottomNavigation />\n    </>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}