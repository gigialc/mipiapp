{"ast":null,"code":"var _jsxFileName = \"/Users/georgina/demo/frontend/src/Shop/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport ProductCard from './components/ProductCard';\nimport SignIn from './components/SignIn';\nimport Header from './components/Header';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n; // Make TS accept the existence of our window.__ENV object - defined in index.html:\n\nconst _window = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\nconst axiosClient = axios.create({\n  baseURL: `${backendURL}`,\n  timeout: 20000,\n  withCredentials: true\n});\nconst config = {\n  headers: {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': '*'\n  }\n};\nexport default function Shop() {\n  _s();\n\n  const [user, setUser] = useState(null);\n  const [showModal, setShowModal] = useState(false);\n\n  const signIn = async () => {\n    const scopes = ['username', 'payments'];\n    const authResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n    signInUser(authResult);\n    setUser(authResult.user);\n  };\n\n  const signOut = () => {\n    setUser(null);\n    signOutUser();\n  };\n\n  const signInUser = authResult => {\n    axiosClient.post('/user/signin', {\n      authResult\n    });\n    return setShowModal(false);\n  };\n\n  const signOutUser = () => {\n    return axiosClient.get('/user/signout');\n  };\n\n  const onModalClose = () => {\n    setShowModal(false);\n  };\n\n  const orderProduct = async (memo, amount, paymentMetadata) => {\n    if (user === null) {\n      return setShowModal(true);\n    }\n\n    const paymentData = {\n      amount,\n      memo,\n      metadata: paymentMetadata\n    };\n    const callbacks = {\n      onReadyForServerApproval,\n      onReadyForServerCompletion,\n      onCancel,\n      onError\n    };\n    const payment = await window.Pi.createPayment(paymentData, callbacks);\n    console.log(payment);\n  };\n\n  const onIncompletePaymentFound = payment => {\n    console.log(\"onIncompletePaymentFound\", payment);\n    return axiosClient.post('/payments/incomplete', {\n      payment\n    });\n  };\n\n  const onReadyForServerApproval = paymentId => {\n    console.log(\"onReadyForServerApproval\", paymentId);\n    axiosClient.post('/payments/approve', {\n      paymentId\n    }, config);\n  };\n\n  const onReadyForServerCompletion = (paymentId, txid) => {\n    console.log(\"onReadyForServerCompletion\", paymentId, txid);\n    axiosClient.post('/payments/complete', {\n      paymentId,\n      txid\n    }, config);\n  };\n\n  const onCancel = paymentId => {\n    console.log(\"onCancel\", paymentId);\n    return axiosClient.post('/payments/cancelled_payment', {\n      paymentId\n    });\n  };\n\n  const onError = (error, payment) => {\n    console.log(\"onError\", error);\n\n    if (payment) {\n      console.log(payment); // handle the error accordingly\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      user: user,\n      onSignIn: signIn,\n      onSignOut: signOut\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProductCard, {\n      name: \"Abortion Rights\",\n      description: \" The new abortion laws in the United States are a great example of why abortion stigma is a big issue that has to be tackled. This community supports and openly talks about abortion to empower each other and educate the rest of the world.\",\n      price: 0.1,\n      pictureURL: \"https://flic.kr/p/mAn1Hc\",\n      pictureCaption: \"Picture by Dan Parsons - https://www.flickr.com/photos/dan90266/42759561/, CC BY-SA 2.0, https://commons.wikimedia.org/w/index.php?curid=323125\",\n      onClickBuy: () => orderProduct(\"Order Apple Pie\", 3, {\n        productId: 'apple_pie_1'\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProductCard, {\n      name: \"Mental Health\",\n      description: \"Talking opnely about mental health creates a culture of understanding. By starting conversations about mental health, we can create a more inclusive and compassionate society where people feel comfortable seeking help and support when they need it.\",\n      price: 5,\n      pictureURL: \"https://live.staticflickr.com/1156/5134246283_f2686ff8a8_b.jpg\",\n      pictureCaption: \"Picture by Sistak - https://www.flickr.com/photos/94801434@N00/5134246283, CC BY-SA 2.0\",\n      onClickBuy: () => orderProduct(\"Order Lemon Meringue Pie\", 5, {\n        productId: 'lemon_pie_1'\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProductCard, {\n      name: \"Period Stigma\",\n      description: \"Periods are beautiful and normal, they should be celebrated and not hidden. This community aims to normalize talking about periods to ensure that menstruators are healthy and comfortable in their bodies.  \",\n      price: 5,\n      pictureURL: \"https://live.staticflickr.com/1156/5134246283_f2686ff8a8_b.jpg\",\n      pictureCaption: \"Picture by Sistak - https://www.flickr.com/photos/94801434@N00/5134246283, CC BY-SA 2.0\",\n      onClickBuy: () => orderProduct(\"Order Lemon Meringue Pie\", 5, {\n        productId: 'lemon_pie_1'\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }, this), showModal && /*#__PURE__*/_jsxDEV(SignIn, {\n      onSignIn: signIn,\n      onModalClose: onModalClose\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 22\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Shop, \"7F3ln6W08puJMs22ml1OmKJPERk=\");\n\n_c = Shop;\n\nvar _c;\n\n$RefreshReg$(_c, \"Shop\");","map":{"version":3,"names":["React","useState","axios","ProductCard","SignIn","Header","_window","window","backendURL","__ENV","axiosClient","create","baseURL","timeout","withCredentials","config","headers","Shop","user","setUser","showModal","setShowModal","signIn","scopes","authResult","Pi","authenticate","onIncompletePaymentFound","signInUser","signOut","signOutUser","post","get","onModalClose","orderProduct","memo","amount","paymentMetadata","paymentData","metadata","callbacks","onReadyForServerApproval","onReadyForServerCompletion","onCancel","onError","payment","createPayment","console","log","paymentId","txid","error","productId"],"sources":["/Users/georgina/demo/frontend/src/Shop/index.tsx"],"sourcesContent":["import React, {useState} from 'react';\nimport axios from 'axios';\nimport ProductCard from './components/ProductCard';\nimport SignIn from './components/SignIn';\nimport Header from './components/Header';\n\ntype MyPaymentMetadata = {};\n\ntype AuthResult = {\n  accessToken: string,\n  user: {\n    uid: string,\n    username: string\n  }\n};\n\nexport type User = AuthResult['user'];\n\ninterface PaymentDTO {\n  amount: number,\n  user_uid: string,\n  created_at: string,\n  identifier: string,\n  metadata: Object,\n  memo: string,\n  status: {\n    developer_approved: boolean,\n    transaction_verified: boolean,\n    developer_completed: boolean,\n    cancelled: boolean,\n    user_cancelled: boolean,\n  },\n  to_address: string,\n  transaction: null | {\n    txid: string,\n    verified: boolean,\n    _link: string,\n  },\n};\n\n// Make TS accept the existence of our window.__ENV object - defined in index.html:\ninterface WindowWithEnv extends Window {\n  __ENV?: {\n    backendURL: string, // REACT_APP_BACKEND_URL environment variable\n    sandbox: \"true\" | \"false\", // REACT_APP_SANDBOX_SDK environment variable - string, not boolean!\n  }\n}\n\nconst _window: WindowWithEnv = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\n\nconst axiosClient = axios.create({ baseURL: `${backendURL}`, timeout: 20000, withCredentials: true});\nconst config = {headers: {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'}};\n\n\nexport default function Shop() {\n  const [user, setUser] = useState<User | null>(null);\n  const [showModal, setShowModal] = useState<boolean>(false);\n\n  const signIn = async () => {\n    const scopes = ['username', 'payments'];\n    const authResult: AuthResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n    signInUser(authResult);\n    setUser(authResult.user);\n  }\n\n  const signOut = () => {\n    setUser(null);\n    signOutUser();\n  }\n\n  const signInUser = (authResult: AuthResult) => {\n    axiosClient.post('/user/signin', {authResult});\n    return setShowModal(false);\n  }\n\n  const signOutUser = () => {\n    return axiosClient.get('/user/signout');\n  }\n\n  const onModalClose = () => {\n    setShowModal(false);\n  }\n\n  const orderProduct = async (memo: string, amount: number, paymentMetadata: MyPaymentMetadata) => {\n    if(user === null) {\n      return setShowModal(true);\n    }\n    const paymentData = { amount, memo, metadata: paymentMetadata };\n    const callbacks = {\n      onReadyForServerApproval,\n      onReadyForServerCompletion,\n      onCancel,\n      onError\n    };\n    const payment = await window.Pi.createPayment(paymentData, callbacks);\n    console.log(payment);\n  }\n\n  const onIncompletePaymentFound = (payment: PaymentDTO) => {\n    console.log(\"onIncompletePaymentFound\", payment);\n    return axiosClient.post('/payments/incomplete', {payment});\n  }\n\n  const onReadyForServerApproval = (paymentId: string) => {\n    console.log(\"onReadyForServerApproval\", paymentId);\n    axiosClient.post('/payments/approve', {paymentId}, config);\n  }\n\n  const onReadyForServerCompletion = (paymentId: string, txid: string) => {\n    console.log(\"onReadyForServerCompletion\", paymentId, txid);\n    axiosClient.post('/payments/complete', {paymentId, txid}, config);\n  }\n\n  const onCancel = (paymentId: string) => {\n    console.log(\"onCancel\", paymentId);\n    return axiosClient.post('/payments/cancelled_payment', {paymentId});\n  }\n\n  const onError = (error: Error, payment?: PaymentDTO) => {\n    console.log(\"onError\", error);\n    if (payment) {\n      console.log(payment);\n      // handle the error accordingly\n    }\n  }\n\n  return (\n    <>\n      <Header user={user} onSignIn={signIn} onSignOut={signOut}/>\n\n      <ProductCard\n        name=\"Abortion Rights\"\n        description=\" The new abortion laws in the United States are a great example of why abortion stigma is a big issue that has to be tackled. This community supports and openly talks about abortion to empower each other and educate the rest of the world.\"\n        price={0.1}\n        pictureURL=\"https://flic.kr/p/mAn1Hc\"\n        pictureCaption=\"Picture by Dan Parsons - https://www.flickr.com/photos/dan90266/42759561/, CC BY-SA 2.0, https://commons.wikimedia.org/w/index.php?curid=323125\"\n        onClickBuy={() => orderProduct(\"Order Apple Pie\", 3, { productId: 'apple_pie_1' })}\n      />\n      <ProductCard\n        name=\"Mental Health\"\n        description=\"Talking opnely about mental health creates a culture of understanding. By starting conversations about mental health, we can create a more inclusive and compassionate society where people feel comfortable seeking help and support when they need it.\"\n        price={5}\n        pictureURL=\"https://live.staticflickr.com/1156/5134246283_f2686ff8a8_b.jpg\"\n        pictureCaption=\"Picture by Sistak - https://www.flickr.com/photos/94801434@N00/5134246283, CC BY-SA 2.0\"\n        onClickBuy={() => orderProduct(\"Order Lemon Meringue Pie\", 5, { productId: 'lemon_pie_1' })}\n      />\n      <ProductCard\n        name=\"Period Stigma\"\n        description=\"Periods are beautiful and normal, they should be celebrated and not hidden. This community aims to normalize talking about periods to ensure that menstruators are healthy and comfortable in their bodies. \n        \"\n        price={5}\n        pictureURL=\"https://live.staticflickr.com/1156/5134246283_f2686ff8a8_b.jpg\"\n        pictureCaption=\"Picture by Sistak - https://www.flickr.com/photos/94801434@N00/5134246283, CC BY-SA 2.0\"\n        onClickBuy={() => orderProduct(\"Order Lemon Meringue Pie\", 5, { productId: 'lemon_pie_1' })}\n      />\n\n      { showModal && <SignIn onSignIn={signIn} onModalClose={onModalClose} /> }\n    </>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}