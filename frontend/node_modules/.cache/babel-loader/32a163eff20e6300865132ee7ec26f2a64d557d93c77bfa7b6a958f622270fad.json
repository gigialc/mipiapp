{"ast":null,"code":"var _jsxFileName = \"/Users/georgina/DestigFemmeDemoPi/frontend/src/Shop/components/Auth.tsx\",\n  _s = $RefreshSig$();\n//Created by Georgina Alacaraz\nimport React from \"react\";\nimport axios from \"axios\";\nimport { onIncompletePaymentFound } from \"./Payments\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const UserContext = /*#__PURE__*/React.createContext(null);\nconst _window = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\nconst axiosClient = axios.create({\n  baseURL: `${backendURL}`,\n  timeout: 20000,\n  withCredentials: true\n});\nconst AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = React.useState({\n    uid: '',\n    username: '',\n    community: []\n  });\n  const [showModal, setShowModal] = React.useState(false);\n  const [community, setCommunity] = React.useState([]);\n  const [post, setPost] = React.useState([]);\n  const [comment, setComment] = React.useState([]);\n  const addCommunityToUser = newCommunity => {\n    setCommunity(prevCommunities => [...prevCommunities, newCommunity]);\n  };\n  const addCommentToPost = newComment => {\n    setPost(prevComments => [...prevComments, newComment]);\n  };\n  const signIn = async () => {\n    const scopes = ['username', 'payments', 'wallet_address'];\n    const authResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n    await signInUser(authResult);\n    setUser(authResult.user);\n    setShowModal(false);\n    getCommunity();\n  };\n  const signInUser = async authResult => {\n    await axiosClient.post('/user/signin', {\n      authResult\n    });\n    return setShowModal(false);\n  };\n  const signOutUser = async () => {\n    const nullUser = {\n      uid: '',\n      username: '',\n      community: []\n    };\n    setUser(nullUser);\n  };\n  const saveUser = () => {\n    user.uid === '' ? signIn() : signOutUser();\n  };\n  const saveShowModal = value => {\n    setShowModal(value);\n  };\n  const onModalClose = () => {\n    saveShowModal(false);\n  };\n  const getCommunity = async () => {\n    try {\n      const response = await fetch(`${backendURL}/community`, {\n        credentials: 'include'\n      });\n      if (!response.ok) {\n        throw new Error('Network response was not ok');\n      }\n      const communityData = await response.json();\n      setCommunity(communityData);\n    } catch (error) {\n      console.error('Failed to fetch communities:', error);\n    }\n  };\n  React.useEffect(() => {\n    getCommunity();\n  }, []);\n  const userContext = {\n    user,\n    community,\n    // Add the community property to the userContext\n    saveUser,\n    showModal,\n    saveShowModal,\n    onModalClose,\n    addCommunityToUser,\n    addPostToCommunity,\n    addCommentToPost\n  };\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: userContext,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"fRVGJWpRi4/ev3TvVZ7ct1lxXAU=\");\n_c = AuthProvider;\nexport default AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","axios","onIncompletePaymentFound","jsxDEV","_jsxDEV","UserContext","createContext","_window","window","backendURL","__ENV","axiosClient","create","baseURL","timeout","withCredentials","AuthProvider","children","_s","user","setUser","useState","uid","username","community","showModal","setShowModal","setCommunity","post","setPost","comment","setComment","addCommunityToUser","newCommunity","prevCommunities","addCommentToPost","newComment","prevComments","signIn","scopes","authResult","Pi","authenticate","signInUser","getCommunity","signOutUser","nullUser","saveUser","saveShowModal","value","onModalClose","response","fetch","credentials","ok","Error","communityData","json","error","console","useEffect","userContext","addPostToCommunity","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/georgina/DestigFemmeDemoPi/frontend/src/Shop/components/Auth.tsx"],"sourcesContent":["//Created by Georgina Alacaraz\nimport React from \"react\";\nimport { User, AuthResult, UserContextType, WindowWithEnv, CommunityType } from \"./Types\";\nimport axios from \"axios\";\nimport { onIncompletePaymentFound } from \"./Payments\";\n\nexport const UserContext = React.createContext<UserContextType | null >(null);\n\nconst _window: WindowWithEnv = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\n\nconst axiosClient = axios.create({ baseURL: `${backendURL}`, timeout: 20000, withCredentials: true});\n\nconst AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n    const [user, setUser] = React.useState<User>( { uid: '', username: '',  community: [] } );\n    const [showModal, setShowModal] = React.useState<boolean>(false);\n    const [community, setCommunity] = React.useState<CommunityType[]>([]);\n    const [post, setPost] = React.useState<CommunityType[]>([]);\n    const [comment, setComment] = React.useState<CommunityType[]>([]);\n\n    const addCommunityToUser = (newCommunity: CommunityType) => {\n      setCommunity((prevCommunities) => [...prevCommunities, newCommunity]);\n    };\n\n    const addCommentToPost = (newComment: CommunityType) => {\n      setPost((prevComments) => [...prevComments, newComment]);\n    }\n  \n    const signIn = async () => {\n      const scopes = ['username', 'payments', 'wallet_address'];\n      const authResult: AuthResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n      await signInUser(authResult);\n      setUser(authResult.user);\n      setShowModal(false);\n      getCommunity();\n    }\n\n    const signInUser = async (authResult: AuthResult) => {\n        await axiosClient.post('/user/signin', {authResult});\n        return setShowModal(false);\n    }\n    \n    const signOutUser = async() =>{\n      const nullUser = { uid: '', username: '', community: [] };\n      setUser(nullUser);\n    }\n\n    const saveUser = () =>{\n      user.uid === '' ? signIn() : signOutUser();\n    }\n\n    const saveShowModal = (value: boolean) => {\n      setShowModal(value);\n    }\n\n    const onModalClose = () => {\n      saveShowModal(false);\n    }\n\n    const getCommunity = async () => {\n      try {\n        const response = await fetch(`${backendURL}/community`, { credentials: 'include' });\n        if (!response.ok) {\n          throw new Error('Network response was not ok');\n        }\n        const communityData = await response.json();\n        setCommunity(communityData);\n      } catch (error) {\n        console.error('Failed to fetch communities:', error);\n      }\n    }\n\n    React.useEffect(() => {\n      getCommunity();\n    }, []);\n\n    const userContext: UserContextType = {\n      user,\n      community, // Add the community property to the userContext\n      saveUser,\n      showModal,\n      saveShowModal,\n      onModalClose,\n      addCommunityToUser,\n      addPostToCommunity,\n      addCommentToPost, \n    };\n\n    return (\n        <UserContext.Provider value={ userContext }>\n            {children}\n        </UserContext.Provider>\n    )\n  }\nexport default AuthProvider;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}