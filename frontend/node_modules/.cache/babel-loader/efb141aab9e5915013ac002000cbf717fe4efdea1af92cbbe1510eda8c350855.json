{"ast":null,"code":"var _jsxFileName = \"/Users/georgina/DestigFemmeDemoPi/frontend/src/Shop/components/Auth.tsx\",\n  _s = $RefreshSig$();\nimport React from \"react\";\nimport axios from \"axios\";\nimport { onIncompletePaymentFound } from \"./Payments\";\n\n/* DEVELOPER NOTE:\n    The useContext Hook is initiated here to pass the user information\n    between the various pages of the app. It is important to use the\n    react-dom links in your app so there is no re-render which causes \n    loss of the context. \n\n    To read more on react context see, https://react.dev/reference/react/useContext\n*/\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const UserContext = /*#__PURE__*/React.createContext(null);\nconst _window = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\nconst axiosClient = axios.create({\n  baseURL: `${backendURL}`,\n  timeout: 20000,\n  withCredentials: true\n});\nconst AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = React.useState({\n    uid: '',\n    username: ''\n  });\n  const [showModal, setShowModal] = React.useState(false);\n  const [refunds, setRefunds] = React.useState([{\n    _id: '',\n    pi_payment_id: '',\n    product_id: '',\n    user: '',\n    amount: 0,\n    txid: '',\n    paid: false,\n    cancelled: false,\n    completed: false,\n    created_at: '',\n    is_refund: false,\n    refunded_at: ''\n  }]);\n  const signIn = async () => {\n    const scopes = ['username', 'payments', 'wallet_address'];\n    const authResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n    await signInUser(authResult);\n    setUser(authResult.user);\n    setShowModal(false);\n    saveRefunds();\n  };\n  const signInUser = async authResult => {\n    await axiosClient.post('/user/signin', {\n      authResult\n    });\n    return setShowModal(false);\n  };\n  const signOutUser = async () => {\n    const nullUser = {\n      uid: '',\n      username: ''\n    };\n    setUser(nullUser);\n  };\n  const saveUser = () => {\n    user.uid === '' ? signIn() : signOutUser();\n  };\n  const saveShowModal = value => {\n    setShowModal(value);\n  };\n  const onModalClose = () => {\n    saveShowModal(false);\n  };\n  const userContext = {\n    user,\n    saveUser,\n    showModal,\n    saveShowModal,\n    refunds,\n    saveRefunds,\n    onModalClose\n  };\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: userContext,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"bUxOxpxXgExNwrARVyWwH6SdOYE=\");\n_c = AuthProvider;\nexport default AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","axios","onIncompletePaymentFound","jsxDEV","_jsxDEV","UserContext","createContext","_window","window","backendURL","__ENV","axiosClient","create","baseURL","timeout","withCredentials","AuthProvider","children","_s","user","setUser","useState","uid","username","showModal","setShowModal","refunds","setRefunds","_id","pi_payment_id","product_id","amount","txid","paid","cancelled","completed","created_at","is_refund","refunded_at","signIn","scopes","authResult","Pi","authenticate","signInUser","saveRefunds","post","signOutUser","nullUser","saveUser","saveShowModal","value","onModalClose","userContext","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/georgina/DestigFemmeDemoPi/frontend/src/Shop/components/Auth.tsx"],"sourcesContent":["import React from \"react\";\nimport { User, AuthResult, UserContextType, WindowWithEnv, RefundType } from \"./Types\";\nimport axios from \"axios\";\nimport { onIncompletePaymentFound } from \"./Payments\";\n\n/* DEVELOPER NOTE:\n    The useContext Hook is initiated here to pass the user information\n    between the various pages of the app. It is important to use the\n    react-dom links in your app so there is no re-render which causes \n    loss of the context. \n\n    To read more on react context see, https://react.dev/reference/react/useContext\n*/\n\nexport const UserContext = React.createContext<UserContextType | null >(null);\n\nconst _window: WindowWithEnv = window;\nconst backendURL = _window.__ENV && _window.__ENV.backendURL;\n\nconst axiosClient = axios.create({ baseURL: `${backendURL}`, timeout: 20000, withCredentials: true});\n\nconst AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n        const [user, setUser] = React.useState<User>( { uid: '', username: '' } )\n        const [showModal, setShowModal] = React.useState<boolean>(false);\n        const [refunds, setRefunds] = React.useState<RefundType[]>(\n            [{\n                _id: '',\n                pi_payment_id: '',\n                product_id: '',\n                user: '',\n        amount: 0,\n        txid: '',\n        paid: false,\n        cancelled: false,\n        completed: false,\n        created_at: '',\n        is_refund: false,\n        refunded_at: ''\n      }]);\n\n    const signIn = async () => {\n      const scopes = ['username', 'payments', 'wallet_address'];\n      const authResult: AuthResult = await window.Pi.authenticate(scopes, onIncompletePaymentFound);\n      await signInUser(authResult);\n      setUser(authResult.user);\n      setShowModal(false);\n      saveRefunds();\n    }\n\n    const signInUser = async (authResult: AuthResult) => {\n        await axiosClient.post('/user/signin', {authResult});\n        return setShowModal(false);\n    }\n    \n    const signOutUser = async() =>{\n      const nullUser = { uid: '', username: '' };\n      setUser(nullUser);\n    }\n\n    const saveUser = () =>{\n      user.uid === '' ? signIn() : signOutUser();\n    }\n\n    const saveShowModal = (value: boolean) => {\n      setShowModal(value);\n    }\n\n    const onModalClose = () => {\n      saveShowModal(false);\n    }\n\n    const userContext: UserContextType = {\n      user, \n      saveUser, \n      showModal, \n      saveShowModal,\n      refunds,\n      saveRefunds,\n      onModalClose,\n    }\n\n    return (\n        <UserContext.Provider value={ userContext }>\n            {children}\n        </UserContext.Provider>\n    )\n}\n\nexport default AuthProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}