<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destig Femme Game</title>
</head>
<body>
    <!-- Ensure you have the correct sandbox attributes if needed. Remove sandbox if not using it. -->
    <iframe id="game-iframe" src="https://www.destigfemme.app" allow="scripts"></iframe>

    <script>
        // Set up environment variables (ensure these are correctly replaced in your build process)
        window.__ENV = {
            backendURL: "%REACT_APP_BACKEND_URL%",
            sandbox: "%REACT_APP_SANDBOX_SDK%" // Even though you might not need it, ensure it is correctly set
        };

        // Import the Pi Network App Platform SDK
        const piSdkScript = document.createElement('script');
        piSdkScript.src = "https://sdk.minepi.com/pi-sdk.js";
        document.head.appendChild(piSdkScript);

        piSdkScript.onload = () => {
            // Initialize Pi SDK based on the environment
            const runSDKInSandboxMode = window.__ENV.sandbox === "true"; // treat env vars as strings, not booleans
            Pi.init({ version: "2.0", sandbox: runSDKInSandboxMode });

            // Add event listener for postMessage
            window.addEventListener("message", (event) => {
                const validOrigin = "https://www.destigfemme.app";
                console.log(`Received message from origin: ${event.origin}`);
                if (event.origin !== validOrigin) {
                    console.error(`Invalid origin: ${event.origin}, expected ${validOrigin}`);
                    return;
                }
                // Handle the valid message
                console.log("Received message:", event.data);
            }, false);
        };

        // Ensure the iframe has loaded before sending the message
        const iframe = document.getElementById('game-iframe');
        iframe.addEventListener('load', () => {
            const targetOrigin = 'https://www.destigfemme.app';
            // Use postMessage to communicate with the iframe
            iframe.contentWindow.postMessage('hello world', targetOrigin);
        });
    </script>
</body>
</html>
